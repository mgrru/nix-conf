global {
  wan_interface: auto
  log_level: info
  allow_insecure: false
  auto_config_kernel_parameter: true

  tcp_check_url: 'https://cloudflare-dns.com/dns-query,1.1.1.1,2606:4700:4700::1111'
  tcp_check_http_method: HEAD

  udp_check_dns: '1dot1dot1dot1.cloudflare-dns.com,1.1.1.1,2606:4700:4700::1111'

  check_interval: 30s

  check_tolerance: 50ms

  dial_mode: domain

  sniffing_timeout: 100ms
}

subscription {
  sub1: 'https://66a4d1.xfxcloud.click/api/v1/client/subscribe?token=5a81455c3edb4e421280b26b007f5c40'
}

dns {
  upstream {
    trdns: 'udp://180.184.1.1:53'
    cfdns: 'udp://1.1.1.1:53'
    googledns: 'udp://8.8.8.8:53'
  }

  routing {
    request {
      qname(geosite:cn) -> trdns
      fallback: cfdns
    }


#    request {
#      fallback: googledns
#    }
#    response {
#      upstream(googledns) -> accept
#      ip(geoip:private) && !qname(geosite:cn) -> googledns
#      fallback: accept
#    }
  }
}

group {
  proxy {
    filter: subtag(sub1) && !name(keyword: 'ExpireAt:')
    policy: min_moving_avg
  }
}

routing {
  pname(NetworkManager) -> direct
  dip(224.0.0.0/3, 'ff00::/8') -> direct


  l4proto(udp) && dport(443) -> block
  dip(geoip:private) -> direct
  dip(geoip:cn) -> direct
  domain(geosite:cn) -> direct

  fallback: proxy
}
